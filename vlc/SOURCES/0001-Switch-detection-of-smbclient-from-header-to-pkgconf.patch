From 9cbe32f2d9542a4a8d17a0828c1a7c0046397f57 Mon Sep 17 00:00:00 2001
From: Nicolas Chauvet <kwizart@gmail.com>
Date: Sat, 23 Feb 2013 16:39:23 +0100
Subject: [PATCH] Switch detection of smbclient from header to pkgconfig

---
 configure.ac              | 5 +++--
 modules/access/Modules.am | 2 +-
 2 files changed, 4 insertions(+), 3 deletions(-)

diff --git a/configure.ac b/configure.ac
index 65377ac..6c634f2 100644
--- a/configure.ac
+++ b/configure.ac
@@ -1874,9 +1874,10 @@ dnl
 AC_ARG_ENABLE(smb,
   [AS_HELP_STRING([--disable-smb], [disable SMB/CIFS support (default auto)])])
 if test "${enable_smb}" != "no"; then
-  AC_CHECK_HEADERS(libsmbclient.h,
+  PKG_CHECK_MODULES(SMBCLIENT, smbclient,
     [ VLC_ADD_PLUGIN([access_smb])
-      VLC_ADD_LIBS([access_smb],[-lsmbclient]) ],
+      VLC_ADD_CFLAGS([access_smb],[$SMBCLIENT_CFLAGS])
+      VLC_ADD_LIBS([access_smb],[$SMBCLIENT_LIBS])],
     [ if test -n "${enable_smb}"; then
         AC_MSG_ERROR([cannot find libsmbclient headers])
      fi ])
diff --git a/modules/access/Modules.am b/modules/access/Modules.am
index ff6047e..c06c89b 100644
--- a/modules/access/Modules.am
+++ b/modules/access/Modules.am
@@ -35,7 +35,7 @@ libsdp_plugin_la_LIBADD = $(AM_LIBADD)
 libsdp_plugin_la_DEPENDENCIES =
 
 libaccess_smb_plugin_la_SOURCES = smb.c
-libaccess_smb_plugin_la_CFLAGS = $(AM_CFLAGS)
+libaccess_smb_plugin_la_CFLAGS = $(AM_CFLAGS) $(CFLAGS_access_smb)
 libaccess_smb_plugin_la_LIBADD = $(AM_LIBADD) $(LIBS_access_smb)
 if HAVE_WIN32
 libaccess_smb_plugin_la_LIBADD += -lmpr
-- 
1.7.11.7

